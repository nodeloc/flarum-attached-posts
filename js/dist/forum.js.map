{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@xypp/flarum-attached-posts/./src/forum/addAttachComponents.tsx","webpack://@xypp/flarum-attached-posts/./src/forum/components/AttachContainer.tsx","webpack://@xypp/flarum-attached-posts/./src/forum/components/AttachedPostPreviewer.tsx","webpack://@xypp/flarum-attached-posts/./src/forum/index.ts","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['common/Component']\"","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['common/Model']\"","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['common/components/Button']\"","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['common/components/Link']\"","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['common/extend']\"","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['common/helpers/userOnline']\"","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['common/helpers/username']\"","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['common/models/Post']\"","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['common/utils/classList']\"","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['forum/app']\"","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['forum/components/CommentPost']\"","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['forum/utils/PostControls']\"","webpack://@xypp/flarum-attached-posts/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@xypp/flarum-attached-posts/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@xypp/flarum-attached-posts/webpack/bootstrap","webpack://@xypp/flarum-attached-posts/webpack/runtime/compat get default export","webpack://@xypp/flarum-attached-posts/webpack/runtime/define property getters","webpack://@xypp/flarum-attached-posts/webpack/runtime/hasOwnProperty shorthand","webpack://@xypp/flarum-attached-posts/webpack/runtime/make namespace object","webpack://@xypp/flarum-attached-posts/./forum.ts"],"sourcesContent":["import app from 'flarum/forum/app';\r\nimport { extend } from 'flarum/common/extend';\r\nimport CommentPost from 'flarum/forum/components/CommentPost';\r\nimport AttachContainer from './components/AttachContainer';\r\nimport PostControls from 'flarum/forum/utils/PostControls';\r\nimport Button from 'flarum/common/components/Button';\r\nimport Post from 'flarum/common/models/Post';\r\nimport Model from 'flarum/common/Model';\r\n\r\nexport default function addAttachComponents() {\r\n    Post.prototype.attached_posts = Model.hasMany<Post>('attached_posts');\r\n\r\n    extend(CommentPost.prototype, 'footerItems', function (items) {\r\n        items.add('attached-posts', <AttachContainer post={this.attrs.post} />);\r\n    });\r\n\r\n    extend(PostControls, 'moderationControls', function (items, post) {\r\n        const discussion = post.discussion();\r\n        const postUser = post.user();\r\n        const currentUser = app.session?.user;\r\n        let show = false;\r\n        if (currentUser && postUser && currentUser.id() !== postUser.id()) {\r\n            if (discussion.attribute(\"xypp-attached-posts-moderate\")) {\r\n                show = true;\r\n            }\r\n        } else if (discussion.attribute(\"xypp-attached-posts-use\")) {\r\n            show = true;\r\n        }\r\n\r\n        if (show) {\r\n            items.add('xypp-attached-posts', Button.component({\r\n                icon: 'fas fa-paperclip',\r\n                className: 'Button Button--link',\r\n                onclick: () => {\r\n                    discussion.pushAttributes({\r\n                        'xypp-attached-posts.select_for_target': post.id()\r\n                    });\r\n                    m.redraw();\r\n                }\r\n            },\r\n                app.translator.trans('xypp-attached-posts.forum.attach-btn'))\r\n            )\r\n        }\r\n    });\r\n}","import app from 'flarum/forum/app';\r\nimport Component, { ComponentAttrs } from 'flarum/common/Component';\r\nimport username from 'flarum/common/helpers/username';\r\nimport userOnline from 'flarum/common/helpers/userOnline';\r\nimport Link from 'flarum/common/components/Link';\r\nimport classList from 'flarum/common/utils/classList';\r\nimport Post from 'flarum/common/models/Post';\r\nimport User from 'flarum/common/models/User';\r\nimport ItemList from 'flarum/common/utils/ItemList';\r\nimport Discussion from 'flarum/common/models/Discussion';\r\nimport humanTime from 'flarum/common/helpers/humanTime';\r\nimport Button from 'flarum/common/components/Button';\r\nimport AttachedPostPreviewer from './AttachedPostPreviewer';\r\n\r\n\r\nexport default class AttachContainer extends Component<{\r\n    post: Post;\r\n}> {\r\n    oninit(vnode: any) {\r\n        super.oninit(vnode);\r\n    }\r\n\r\n    view() {\r\n        const selectForTarget = this.attrs.post.discussion().attribute<string>('xypp-attached-posts.select_for_target');\r\n        const attached = this.attrs.post.attached_posts();\r\n        return (\r\n            <div className=\"AttachContainer\">\r\n                {\r\n                    (attached && attached.length) ?\r\n                        attached.map(p => <AttachedPostPreviewer post={p} parentPost={this.attrs.post} ></AttachedPostPreviewer>)\r\n                        :\r\n                        \"\"\r\n                }\r\n                {\r\n                    (selectForTarget && selectForTarget != this.attrs.post.id()) ? (\r\n                        <div className=\"AttachContainer-select\">\r\n                            <span>\r\n                                {app.translator.trans(\"xypp-attached-posts.forum.attach\")}\r\n                            </span>\r\n                            <Button onclick={this.attachToCurrent.bind(this)} className='Button Button--primary'>{app.translator.trans(\"xypp-attached-posts.forum.attach-btn\")}</Button>\r\n                        </div>\r\n                    ) : \"\"\r\n                }\r\n            </div>\r\n        );\r\n    }\r\n\r\n    attachToCurrent(e: MouseEvent) {\r\n        e.preventDefault();\r\n        const selectForTarget = this.attrs.post.discussion().attribute<number>('xypp-attached-posts.select_for_target');\r\n        this.attrs.post.discussion().pushAttributes({ 'xypp-attached-posts.select_for_target': null });\r\n        m.redraw();\r\n        this.attrs.post.save({\r\n            attach_post: selectForTarget\r\n        }).then(()=>m.redraw());\r\n    }\r\n}","import app from 'flarum/forum/app';\r\nimport Component, { ComponentAttrs } from 'flarum/common/Component';\r\nimport username from 'flarum/common/helpers/username';\r\nimport userOnline from 'flarum/common/helpers/userOnline';\r\nimport Link from 'flarum/common/components/Link';\r\nimport classList from 'flarum/common/utils/classList';\r\nimport Post from 'flarum/common/models/Post';\r\nimport User from 'flarum/common/models/User';\r\nimport ItemList from 'flarum/common/utils/ItemList';\r\nimport Discussion from 'flarum/common/models/Discussion';\r\nimport humanTime from 'flarum/common/helpers/humanTime';\r\nimport Button from 'flarum/common/components/Button';\r\n\r\nexport default class AttachedPostPreviewer extends Component<{\r\n    post: Post,\r\n    parentPost: Post\r\n}> {\r\n    showMore: boolean = false;\r\n    removing: boolean = false;\r\n    oninit(vnode: any) {\r\n        super.oninit(vnode);\r\n    }\r\n    view() {\r\n        const maxLines = app.forum.attribute<number>('xypp-attached-posts.max-lines');\r\n        const currentUser = app.session?.user;\r\n        const postUser = this.attrs.post.user();\r\n        let canDelete = false;\r\n        if (currentUser && postUser && currentUser.id() !== postUser.id()) {\r\n            if (this.attrs.post.discussion().attribute(\"xypp-attached-posts-moderate\")) {\r\n                canDelete = true;\r\n            }\r\n        } else if (this.attrs.post.discussion().attribute(\"xypp-attached-posts-use\")) {\r\n            canDelete = true;\r\n        }\r\n        return (\r\n            <div className=\"CommentPost\">\r\n                <div className=\"Post-header\">\r\n                    <div className=\"AttachTitle\" onclick={() => app.current.get('stream').goToNumber(this.attrs.post.number())}>\r\n                        <i class=\"fas fa-paperclip\"></i>\r\n                        {app.translator.trans(\"xypp-attached-posts.forum.attached\")}\r\n                    </div>\r\n                    <div className=\"PostUser\">\r\n                        {postUser && userOnline(postUser)}\r\n                        <h3>{postUser ? <Link href={app.route.user(postUser)}>{username(postUser)}</Link> : username(postUser)}</h3>\r\n                    </div>\r\n                </div>\r\n                <div className={classList('Post-body', maxLines > 0 && 'attached-post', (!this.showMore) && \"truncate\")} style={{ '--max-lines': maxLines }}>\r\n                    <div className='Post-body-wrapper'>\r\n                        {m.trust(this.attrs.post.contentHtml())}\r\n                    </div>\r\n                </div>\r\n                <div className=\"AttachedPost-footer\" onclick={(() => { this.showMore = !this.showMore; m.redraw() }).bind(this)}>\r\n                    {this.showMore ? (\r\n                        [\r\n                            <i className=\"fas fa-angle-up\" />,\r\n                            app.translator.trans(\"xypp-attached-posts.forum.show-less\")\r\n                        ]\r\n                    ) : (\r\n                        [\r\n                            <i className=\"fas fa-angle-down\" />,\r\n                            app.translator.trans(\"xypp-attached-posts.forum.show-more\")\r\n                        ]\r\n                    )}\r\n                </div>\r\n\r\n                {canDelete ?\r\n                    <Button className=\"attached-posts-delete Button\" icon=\"fas fa-trash\" onclick={this.unattach.bind(this)} loading={this.removing} disabled={this.removing}>\r\n                        {app.translator.trans(\"xypp-attached-posts.forum.delete\")}\r\n                    </Button>\r\n                    : \"\"\r\n                }\r\n            </div>\r\n        );\r\n    }\r\n\r\n    unattach(e: MouseEvent) {\r\n        e.preventDefault();\r\n        this.removing = true;\r\n        m.redraw();\r\n        this.attrs.parentPost.save({\r\n            unattach_post: this.attrs.post.id()\r\n        }).then(() => m.redraw());\r\n    }\r\n}","import app from 'flarum/forum/app';\nimport addAttachComponents from './addAttachComponents';\n\napp.initializers.add('xypp/flarum-attached-posts', () => {\n  addAttachComponents();\n});\n","module.exports = flarum.core.compat['common/Component'];","module.exports = flarum.core.compat['common/Model'];","module.exports = flarum.core.compat['common/components/Button'];","module.exports = flarum.core.compat['common/components/Link'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['common/helpers/userOnline'];","module.exports = flarum.core.compat['common/helpers/username'];","module.exports = flarum.core.compat['common/models/Post'];","module.exports = flarum.core.compat['common/utils/classList'];","module.exports = flarum.core.compat['forum/app'];","module.exports = flarum.core.compat['forum/components/CommentPost'];","module.exports = flarum.core.compat['forum/utils/PostControls'];","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export * from './src/forum';\n"],"names":["app","extend","CommentPost","AttachContainer","PostControls","Button","Post","Model","addAttachComponents","prototype","attached_posts","hasMany","items","add","m","post","attrs","_app$session","discussion","postUser","user","currentUser","session","show","id","attribute","component","icon","className","onclick","pushAttributes","redraw","translator","trans","Component","AttachedPostPreviewer","_Component","apply","arguments","_inheritsLoose","_proto","oninit","vnode","call","view","_this","selectForTarget","attached","length","map","p","parentPost","attachToCurrent","bind","e","preventDefault","save","attach_post","then","default","username","userOnline","Link","classList","_len","args","Array","_key","concat","showMore","removing","_this2","maxLines","forum","canDelete","current","get","goToNumber","number","href","route","style","trust","contentHtml","unattach","loading","disabled","unattach_post","initializers","setPrototypeOf","t","o","Object","create","constructor","_setPrototypeOf","__proto__"],"sourceRoot":""}