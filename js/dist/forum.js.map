{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@xypp/flarum-attached-posts/webpack/bootstrap","webpack://@xypp/flarum-attached-posts/webpack/runtime/compat get default export","webpack://@xypp/flarum-attached-posts/webpack/runtime/define property getters","webpack://@xypp/flarum-attached-posts/webpack/runtime/hasOwnProperty shorthand","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['forum/app']\"","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['common/extend']\"","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['forum/components/CommentPost']\"","webpack://@xypp/flarum-attached-posts/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@xypp/flarum-attached-posts/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['common/Component']\"","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['common/components/Button']\"","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['common/helpers/username']\"","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['common/helpers/userOnline']\"","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['common/components/Link']\"","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['common/utils/classList']\"","webpack://@xypp/flarum-attached-posts/./src/forum/components/AttachedPostPreviewer.tsx","webpack://@xypp/flarum-attached-posts/./src/forum/components/AttachContainer.tsx","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['forum/utils/PostControls']\"","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['common/models/Post']\"","webpack://@xypp/flarum-attached-posts/external root \"flarum.core.compat['common/Model']\"","webpack://@xypp/flarum-attached-posts/./src/forum/index.ts","webpack://@xypp/flarum-attached-posts/./src/forum/addAttachComponents.tsx"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/CommentPost'];","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/username'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/userOnline'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Link'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/classList'];","import app from 'flarum/forum/app';\r\nimport Component, { ComponentAttrs } from 'flarum/common/Component';\r\nimport username from 'flarum/common/helpers/username';\r\nimport userOnline from 'flarum/common/helpers/userOnline';\r\nimport Link from 'flarum/common/components/Link';\r\nimport classList from 'flarum/common/utils/classList';\r\nimport Post from 'flarum/common/models/Post';\r\nimport User from 'flarum/common/models/User';\r\nimport ItemList from 'flarum/common/utils/ItemList';\r\nimport Discussion from 'flarum/common/models/Discussion';\r\nimport humanTime from 'flarum/common/helpers/humanTime';\r\nimport Button from 'flarum/common/components/Button';\r\n\r\nexport default class AttachedPostPreviewer extends Component<{\r\n    post: Post,\r\n    parentPost: Post\r\n}> {\r\n    showMore: boolean = false;\r\n    removing: boolean = false;\r\n    oninit(vnode: any) {\r\n        super.oninit(vnode);\r\n    }\r\n    view() {\r\n        const maxLines = app.forum.attribute<number>('xypp-attached-posts.max-lines');\r\n        const currentUser = app.session?.user;\r\n        const postUser = this.attrs.post.user();\r\n        let canDelete = false;\r\n        if (currentUser && postUser && currentUser.id() !== postUser.id()) {\r\n            if (this.attrs.post.discussion().attribute(\"xypp-attached-posts-moderate\")) {\r\n                canDelete = true;\r\n            }\r\n        } else if (this.attrs.post.discussion().attribute(\"xypp-attached-posts-use\")) {\r\n            canDelete = true;\r\n        }\r\n        return (\r\n            <div className=\"CommentPost\">\r\n                <div className=\"Post-header\">\r\n                    <div className=\"AttachTitle\" onclick={() => app.current.get('stream').goToNumber(this.attrs.post.number())}>\r\n                        <i class=\"fas fa-paperclip\"></i>\r\n                        {app.translator.trans(\"xypp-attached-posts.forum.attached\")}\r\n                    </div>\r\n                    <div className=\"PostUser\">\r\n                        {postUser && userOnline(postUser)}\r\n                        <h3>{postUser ? <Link href={app.route.user(postUser)}>{username(postUser)}</Link> : username(postUser)}</h3>\r\n                    </div>\r\n                </div>\r\n                <div className={classList('Post-body', maxLines > 0 && 'attached-post', (!this.showMore) && \"truncate\")} style={{ '--max-lines': maxLines }}>\r\n                    <div className='Post-body-wrapper'>\r\n                        {m.trust(this.attrs.post.contentHtml())}\r\n                    </div>\r\n                </div>\r\n                <div className=\"AttachedPost-footer\" onclick={(() => { this.showMore = !this.showMore; m.redraw() }).bind(this)}>\r\n                    {this.showMore ? (\r\n                        [\r\n                            <i className=\"fas fa-angle-up\" />,\r\n                            app.translator.trans(\"xypp-attached-posts.forum.show-less\")\r\n                        ]\r\n                    ) : (\r\n                        [\r\n                            <i className=\"fas fa-angle-down\" />,\r\n                            app.translator.trans(\"xypp-attached-posts.forum.show-more\")\r\n                        ]\r\n                    )}\r\n                </div>\r\n\r\n                {canDelete ?\r\n                    <Button className=\"attached-posts-delete Button\" icon=\"fas fa-trash\" onclick={this.unattach.bind(this)} loading={this.removing} disabled={this.removing}>\r\n                        {app.translator.trans(\"xypp-attached-posts.forum.delete\")}\r\n                    </Button>\r\n                    : \"\"\r\n                }\r\n            </div>\r\n        );\r\n    }\r\n\r\n    unattach(e: MouseEvent) {\r\n        e.preventDefault();\r\n        this.removing = true;\r\n        m.redraw();\r\n        this.attrs.parentPost.save({\r\n            unattach_post: this.attrs.post.id()\r\n        }).then(() => m.redraw());\r\n    }\r\n}","import app from 'flarum/forum/app';\r\nimport Component, { ComponentAttrs } from 'flarum/common/Component';\r\nimport username from 'flarum/common/helpers/username';\r\nimport userOnline from 'flarum/common/helpers/userOnline';\r\nimport Link from 'flarum/common/components/Link';\r\nimport classList from 'flarum/common/utils/classList';\r\nimport Post from 'flarum/common/models/Post';\r\nimport User from 'flarum/common/models/User';\r\nimport ItemList from 'flarum/common/utils/ItemList';\r\nimport Discussion from 'flarum/common/models/Discussion';\r\nimport humanTime from 'flarum/common/helpers/humanTime';\r\nimport Button from 'flarum/common/components/Button';\r\nimport AttachedPostPreviewer from './AttachedPostPreviewer';\r\n\r\n\r\nexport default class AttachContainer extends Component<{\r\n    post: Post;\r\n}> {\r\n    oninit(vnode: any) {\r\n        super.oninit(vnode);\r\n    }\r\n\r\n    view() {\r\n        const selectForTarget = this.attrs.post.discussion().attribute<string>('xypp-attached-posts.select_for_target');\r\n        const attached = this.attrs.post.attached_posts();\r\n        return (\r\n            <div className=\"AttachContainer\">\r\n                {\r\n                    (attached && attached.length) ?\r\n                        attached.map(p => <AttachedPostPreviewer post={p} parentPost={this.attrs.post} ></AttachedPostPreviewer>)\r\n                        :\r\n                        \"\"\r\n                }\r\n                {\r\n                    (selectForTarget && selectForTarget != this.attrs.post.id()) ? (\r\n                        <div className=\"AttachContainer-select\">\r\n                            <span>\r\n                                {app.translator.trans(\"xypp-attached-posts.forum.attach\")}\r\n                            </span>\r\n                            <Button onclick={this.attachToCurrent.bind(this)} className='Button Button--primary'>{app.translator.trans(\"xypp-attached-posts.forum.attach-btn\")}</Button>\r\n                        </div>\r\n                    ) : \"\"\r\n                }\r\n            </div>\r\n        );\r\n    }\r\n\r\n    attachToCurrent(e: MouseEvent) {\r\n        e.preventDefault();\r\n        const selectForTarget = this.attrs.post.discussion().attribute<number>('xypp-attached-posts.select_for_target');\r\n        this.attrs.post.discussion().pushAttributes({ 'xypp-attached-posts.select_for_target': null });\r\n        m.redraw();\r\n        this.attrs.post.save({\r\n            attach_post: selectForTarget\r\n        }).then(()=>m.redraw());\r\n    }\r\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/utils/PostControls'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/Post'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Model'];","import app from 'flarum/forum/app';\nimport addAttachComponents from './addAttachComponents';\n\napp.initializers.add('xypp/flarum-attached-posts', () => {\n  addAttachComponents();\n});\n","import app from 'flarum/forum/app';\r\nimport { extend } from 'flarum/common/extend';\r\nimport CommentPost from 'flarum/forum/components/CommentPost';\r\nimport AttachContainer from './components/AttachContainer';\r\nimport PostControls from 'flarum/forum/utils/PostControls';\r\nimport Button from 'flarum/common/components/Button';\r\nimport Post from 'flarum/common/models/Post';\r\nimport Model from 'flarum/common/Model';\r\n\r\nexport default function addAttachComponents() {\r\n    Post.prototype.attached_posts = Model.hasMany<Post>('attached_posts');\r\n\r\n    extend(CommentPost.prototype, 'footerItems', function (items) {\r\n        items.add('attached-posts', <AttachContainer post={this.attrs.post} />);\r\n    });\r\n\r\n    extend(PostControls, 'moderationControls', function (items, post) {\r\n        const discussion = post.discussion();\r\n        const postUser = post.user();\r\n        const currentUser = app.session?.user;\r\n        let show = false;\r\n        if (currentUser && postUser && currentUser.id() !== postUser.id()) {\r\n            if (discussion.attribute(\"xypp-attached-posts-moderate\")) {\r\n                show = true;\r\n            }\r\n        } else if (discussion.attribute(\"xypp-attached-posts-use\")) {\r\n            show = true;\r\n        }\r\n\r\n        if (show) {\r\n            items.add('xypp-attached-posts', Button.component({\r\n                icon: 'fas fa-paperclip',\r\n                className: 'Button Button--link',\r\n                onclick: () => {\r\n                    discussion.pushAttributes({\r\n                        'xypp-attached-posts.select_for_target': post.id()\r\n                    });\r\n                    m.redraw();\r\n                }\r\n            },\r\n                app.translator.trans('xypp-attached-posts.forum.attach-btn'))\r\n            )\r\n        }\r\n    });\r\n}"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","_setPrototypeOf","t","e","setPrototypeOf","bind","__proto__","_inheritsLoose","create","constructor","AttachedPostPreviewer","_Component","_this","_len","arguments","length","args","Array","_key","apply","concat","showMore","removing","_proto","oninit","vnode","view","_app$session","_this2","maxLines","app","attribute","currentUser","user","postUser","this","attrs","post","canDelete","id","discussion","m","className","onclick","goToNumber","number","class","trans","userOnline","Link","href","username","classList","style","trust","contentHtml","redraw","Button","icon","unattach","loading","disabled","preventDefault","parentPost","save","unattach_post","then","Component","AttachContainer","selectForTarget","attached","attached_posts","map","p","attachToCurrent","pushAttributes","attach_post","add","Post","Model","extend","CommentPost","items","PostControls","show"],"sourceRoot":""}