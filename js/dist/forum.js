(()=>{var t={n:o=>{var s=o&&o.__esModule?()=>o.default:()=>o;return t.d(s,{a:s}),s},d:(o,s)=>{for(var a in s)t.o(s,a)&&!t.o(o,a)&&Object.defineProperty(o,a,{enumerable:!0,get:s[a]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o)};(()=>{"use strict";const o=flarum.core.compat["forum/app"];var s=t.n(o);const a=flarum.core.compat["common/extend"],e=flarum.core.compat["forum/components/CommentPost"];var r=t.n(e);function n(t,o){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},n(t,o)}function c(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,n(t,o)}const p=flarum.core.compat["common/Component"];var i=t.n(p);const u=flarum.core.compat["common/components/Button"];var l=t.n(u);const h=flarum.core.compat["common/helpers/username"];var d=t.n(h);const f=flarum.core.compat["common/helpers/userOnline"];var v=t.n(f);const y=flarum.core.compat["common/components/Link"];var b=t.n(y);const x=flarum.core.compat["common/utils/classList"];var w=t.n(x),_=function(t){function o(){for(var o,s=arguments.length,a=new Array(s),e=0;e<s;e++)a[e]=arguments[e];return(o=t.call.apply(t,[this].concat(a))||this).showMore=!1,o.removing=!1,o}c(o,t);var a=o.prototype;return a.oninit=function(o){t.prototype.oninit.call(this,o)},a.view=function(){var t,o=this,a=s().forum.attribute("xypp-attached-posts.max-lines"),e=null==(t=s().session)?void 0:t.user,r=this.attrs.post.user(),n=!1;return e&&r&&e.id()!==r.id()?this.attrs.post.discussion().attribute("xypp-attached-posts-moderate")&&(n=!0):this.attrs.post.discussion().attribute("xypp-attached-posts-use")&&(n=!0),m("div",{className:"CommentPost"},m("div",{className:"Post-header"},m("div",{className:"AttachTitle",onclick:function(){return s().current.get("stream").goToNumber(o.attrs.post.number())}},m("i",{class:"fas fa-paperclip"}),s().translator.trans("xypp-attached-posts.forum.attached")),m("div",{className:"PostUser"},r&&v()(r),m("h3",null,r?m(b(),{href:s().route.user(r)},d()(r)):d()(r)))),m("div",{className:w()("Post-body",a>0&&"attached-post",!this.showMore&&"truncate"),style:{"--max-lines":a}},m("div",{className:"Post-body-wrapper"},m.trust(this.attrs.post.contentHtml()))),m("div",{className:"AttachedPost-footer",onclick:function(){o.showMore=!o.showMore,m.redraw()}.bind(this)},this.showMore?[m("i",{className:"fas fa-angle-up"}),s().translator.trans("xypp-attached-posts.forum.show-less")]:[m("i",{className:"fas fa-angle-down"}),s().translator.trans("xypp-attached-posts.forum.show-more")]),n?m(l(),{className:"attached-posts-delete Button",icon:"fas fa-trash",onclick:this.unattach.bind(this),loading:this.removing,disabled:this.removing},s().translator.trans("xypp-attached-posts.forum.delete")):"")},a.unattach=function(t){t.preventDefault(),this.removing=!0,m.redraw(),this.attrs.parentPost.save({unattach_post:this.attrs.post.id()}).then((function(){return m.redraw()}))},o}(i()),g=function(t){function o(){return t.apply(this,arguments)||this}c(o,t);var a=o.prototype;return a.oninit=function(o){t.prototype.oninit.call(this,o)},a.view=function(){var t=this,o=this.attrs.post.discussion().attribute("xypp-attached-posts.select_for_target"),a=this.attrs.post.attached_posts();return m("div",{className:"AttachContainer"},a&&a.length?a.map((function(o){return m(_,{post:o,parentPost:t.attrs.post})})):"",o&&o!=this.attrs.post.id()?m("div",{className:"AttachContainer-select"},m("span",null,s().translator.trans("xypp-attached-posts.forum.attach")),m(l(),{onclick:this.attachToCurrent.bind(this),className:"Button Button--primary"},s().translator.trans("xypp-attached-posts.forum.attach-btn"))):"")},a.attachToCurrent=function(t){t.preventDefault();var o=this.attrs.post.discussion().attribute("xypp-attached-posts.select_for_target");this.attrs.post.discussion().pushAttributes({"xypp-attached-posts.select_for_target":null}),m.redraw(),this.attrs.post.save({attach_post:o}).then((function(){return m.redraw()}))},o}(i());const N=flarum.core.compat["forum/utils/PostControls"];var P=t.n(N);const C=flarum.core.compat["common/models/Post"];var O=t.n(C);const M=flarum.core.compat["common/Model"];var k=t.n(M);s().initializers.add("xypp/flarum-attached-posts",(function(){O().prototype.attached_posts=k().hasMany("attached_posts"),(0,a.extend)(r().prototype,"footerItems",(function(t){t.add("attached-posts",m(g,{post:this.attrs.post}))})),(0,a.extend)(P(),"moderationControls",(function(t,o){var a,e=o.discussion(),r=o.user(),n=null==(a=s().session)?void 0:a.user,c=!1;n&&r&&n.id()!==r.id()?e.attribute("xypp-attached-posts-moderate")&&(c=!0):e.attribute("xypp-attached-posts-use")&&(c=!0),c&&t.add("xypp-attached-posts",l().component({icon:"fas fa-paperclip",className:"Button Button--link",onclick:function(){e.pushAttributes({"xypp-attached-posts.select_for_target":o.id()}),m.redraw()}},s().translator.trans("xypp-attached-posts.forum.attach-btn")))}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map